<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--윤여훈 -->
<mapper namespace="hoondb">

<!-- sql문 작성 -->
<resultMap type="beanhoon.PurListVo" id="voMap"/>

	<!-- 생산요청서 리스트 조회 -->
	<select id='pur_list' resultMap="voMap" parameterType="beanhoon.PurListVo">
		select d.dCode, d.dCate, d.dName, to_char(d.dDate, 'yyyy.mm.dd') dDate, to_char(s.srlTerm, 'yyyy.mm.dd') srlTerm, e.eName 
		from document d join srList s on d.dCode = s.srlCode join employees e on d.dWrite = e.eCode 
		where d.dStatus = 0 and d.dcate = #{dCate }
	</select>
	
	<!-- 생산요청서 내용 확인 -->
	<select id='pur_view' resultMap="voMap" parameterType="beanhoon.PurListVo">
		select d.dCode, d.dSign, d.dName, d.dCont, s.srlCode, p.pName, s.srlEa, s.srlTerm, s.srlMCode  
		from document d join srList s on d.dCode = s.srlCode join product p on s.srlMcode = p.pCode
		where d.dCode = #{dCode }
	</select>
	
	<!-- 생산 설정 세팅 -->
	<select id='pur_set' resultMap="voMap" parameterType="beanhoon.PurListVo">
		select s.srlCode, p.pName, s.srlEa, p.pManhour, s.srlTerm, s.srlMCode 
		from srList s join product p on s.srlMcode = p.pCode
		where s.srlCode = #{srlCode } and s.srlMcode = #{srlMCode }
	</select>
	
	<!-- 세팅된 설정을 DB에 저장 -->
	<select id='save_data' resultMap="voMap" parameterType="beanhoon.PurListVo">
		insert into fList(flDcode, flPcode, flpEa, workLine, workPeople, workTime, workStartDate, workEndDate) 
		values(#{srlCode }, #{srlMCode }, #{srlEa }, #{workLine }, #{workPeople }, #{pManhour }, #{workStartDate }, #{workEndDate })
	</select>
	
	<!-- 제품 재고 조회 -->
	<select id='list_p' resultMap="voMap" parameterType="beanhoon.PurListVo">
		select pCode, pName, pCate, pPrice, to_char(pDate, 'yyyy.mm.dd') pDate, pEa, pImage from product
	</select>
	
	<!-- 제품 이미지 조회 -->
	<select id='view_img_p' resultMap="voMap" parameterType="beanhoon.PurListVo">
		select pImage from product where pCode = #{pCode }
	</select>
	
	<!-- 자재 재고 조회 -->
	<select id='list_m' resultMap="voMap" parameterType="beanhoon.PurListVo">
		select mCode, mName, mCate, mPrice, to_char(mDate, 'yyyy.mm.dd') mDate, mEa, mImage from material
	</select>
	
	<!-- 자재 이미지 조회 -->
	<select id='view_img_m' resultMap="voMap" parameterType="beanhoon.PurListVo">
		select mImage from material where mCode = #{mCode }
	</select>
	
	
	
</mapper>